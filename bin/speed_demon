#!/usr/bin/env ruby

require_relative '../lib/speed_demon'

cli = SpeedDemon::CLI.parse(ARGV)
config_dir = '~/.config/speed_demon'

if cli.setup
  SpeedDemon::Setup.execute(output: cli.output, log: cli.log, config: config_dir, frequency: cli.frequency)
elsif cli.measure
  settings = SpeedDemon::Settings.load(config_dir)
  measurements = SpeedDemon::SpeedData.new('speedtest-cli --simple')
  wireless = SpeedDemon::ConnectionType.new.wireless?
  SpeedDemon::SaveData.execute(output_path: settings.output, data: measurements, wireless: wireless)
else
  warn 'speed_demon CLI received no options!'
  system('speed_demon -h')
end
