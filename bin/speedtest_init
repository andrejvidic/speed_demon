#!/usr/bin/env ruby
require 'yaml'
require_relative '../lib/speed_test'

cli = SpeedTest::CLI.parse(ARGV)
settings_path = "~/.config/speedtest"

if cli.setup
  SpeedTest::Setup.execute(cli, settings_path)
elsif cli.measure
  wireless = SpeedTest::ConnectionType.new.wireless?
  measurements = SpeedTest::SpeedData.new
  settings = SpeedTest::Settings.load(settings_path)
  SpeedTest::SaveData.execute(output_path: settings.output, data: measurements, wireless: wireless)
else
  warn "Speedtest CLI received no options!"
  system('speedtest_init -h')
end
