#!/usr/bin/env ruby
require 'yaml'
require_relative '../lib/speed_test'

cli = SpeedTest::CLI.parse(ARGV)

if cli.setup
  SpeedTest::Setup.execute(cli)
elsif cli.measure
  wireless = SpeedTest::ConnectionType.new.wireless?
  measurements = SpeedTest::SpeedData.new
  settings = YAML::load_file(File.expand_path("~/.config/speedtest/settings.yaml"))
  SpeedTest::SaveData.execute(output_path: settings["output"], data: measurements, wireless: wireless)

else
  warn "Speedtest CLI received no options!"
  system('speedtest_init -h')
end
